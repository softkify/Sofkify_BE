# Etapa de build usando Gradle
FROM gradle:8-jdk17 AS build
WORKDIR /app

# Copiar archivos de configuraci贸n
COPY build.gradle settings.gradle ./

# Copiar c贸digo fuente
COPY src ./src

# Construir la aplicaci贸n (sin tests para optimizar)
RUN ./gradlew build -x test

# Etapa de runtime - imagen ligera con JRE
FROM openjdk:17-jre-slim

# Crear directorio de trabajo
WORKDIR /app

# Copiar el JAR construido desde la etapa de build
COPY --from=build /app/build/libs/*.jar app.jar

# Exponer puerto del servicio
EXPOSE 8082

# Variables de entorno por defecto
ENV JAVA_OPTS="-Xmx512m -Xms256m"

# Ejecutar la aplicaci贸n
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
